@using PingPage.Models
@using PingPage.Model
@model List<User>

@{
    ViewData["Title"] = "Friends";
}

<h3>Manage your friends here</h3>
<hr />

@if (ViewData["error"] != null)
{
    <div class="alert alert-danger" role="alert"> @ViewData["error"] </div>
}

<ul class="nav nav-tabs">
    <li class="active"><a data-toggle="tab" href="#list">Friend List</a></li>
    <li><a data-toggle="tab" href="#manage">Manage Friends</a></li>
</ul>

<div class="tab-content">
    <div id="list" class="tab-pane active">
        <h3>Friend List</h3>
        <div style="margin-top: 20px;">
            <partial name="_UserFilter" model="new UserFilterModel()" />
        </div>
        <div id="friendList">
            <partial name="_FriendList" model="Model" />
        </div>
    </div>
    <div id="manage" class="tab-pane">
        <h3>Friend Invite Link</h3>
        <h5>Generate your invite link here</h5>
        <h4>
            Invite link:
            @if (ViewData["inviteLink"] != null)
            {
                <strong>@ViewData["inviteLink"]</strong>
            }
            else
            {
                <strong>NO INVITE LINK GENERATED</strong>
            }
        </h4>
        <div class="container" style="margin-top:0px;">
            <div class="row">
                <div class="col text-center">
                    <a asp-area="" asp-controller="Friend" asp-action="Generate">
                        <button type="button" class="btn btn-primary">Generate</button>
                    </a>
                </div>
            </div>
        </div>
        <hr />
        <h3>Add a friend</h3>
        <h5>Enter an invite link generated by your friend</h5>
        <div id="addFriendForm">
            <partial name="_AddFriend" model="new FriendshipAdderModel()" />
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $("#searchButton").click(function () {
                // Get fields
                var formData = $("#filterForm").serialize();

                // Send request
                $.ajax({
                    url: "@Url.Action("IndexAjax")",
                    method: "POST",
                    data: formData,
                    success: function (html) {
                        $("#friendList").html(html);
                    }
                });
            });
        });
    </script>
}

